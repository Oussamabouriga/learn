-- Fix for DELAI_COMMANDE (Lines 1679-1685)
CASE 
    WHEN tr_commande.CDE_ADVANCED_SWAP_VALIDEE IS NULL 
        THEN FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.CDE_ORDER_VALIDEE, sin.Resolved_Time))
    WHEN tr_commande.CDE_ORDER_VALIDEE IS NULL 
        THEN FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.CDE_ADVANCED_SWAP_VALIDEE, sin.Resolved_Time))
    WHEN tr_commande.CDE_ORDER_VALIDEE IS NOT NULL AND tr_commande.CDE_ADVANCED_SWAP_VALIDEE IS NOT NULL 
        THEN FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.CDE_ORDER_VALIDEE, sin.Resolved_Time)) + 
             FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.CDE_ADVANCED_SWAP_VALIDEE, sin.Resolved_Time))
    ELSE 0 
END AS DELAI_COMMANDE,

-- Fix for DELAI_COMMANDE_SAV (Lines 1688-1693)
CASE 
    WHEN tr_commande.SAV_ADVANCED_SWAP_VALIDEE IS NULL AND tr_commande.SAV_AUDIT_VALIDEE IS NULL AND tr_commande.SAV_RC_VALIDEE IS NULL 
        THEN FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.SAV_REPAIRLOCAL_VALIDEE, sin.Resolved_Time))
    WHEN tr_commande.SAV_REPAIRLOCAL_VALIDEE IS NULL AND tr_commande.SAV_AUDIT_VALIDEE IS NULL AND tr_commande.SAV_RC_VALIDEE IS NULL 
        THEN FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.SAV_ADVANCED_SWAP_VALIDEE, sin.Resolved_Time))
    WHEN tr_commande.SAV_REPAIRLOCAL_VALIDEE IS NULL AND tr_commande.SAV_ADVANCED_SWAP_VALIDEE IS NULL AND tr_commande.SAV_RC_VALIDEE IS NULL 
        THEN FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.SAV_AUDIT_VALIDEE, sin.Resolved_Time))
    WHEN tr_commande.SAV_REPAIRLOCAL_VALIDEE IS NULL AND tr_commande.SAV_ADVANCED_SWAP_VALIDEE IS NULL AND tr_commande.SAV_AUDIT_VALIDEE IS NULL 
        THEN FLOOR(TIMESTAMPDIFF(MINUTE, tr_commande.SAV_RC_VALIDEE, sin.Resolved_Time))
    ELSE 0 
END AS DELAI_COMMANDE_SAV,
